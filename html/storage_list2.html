{% extends 'index.html' %}
{% load static %}

    {% block content %}
    <!-- 핵심 테마 CSS (부트스트랩 포함) -->
    <link href="{% static 'css/storage-list.css' %}" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
<link href="../css/storage-list.css" rel="stylesheet" />
<link href="{% static 'css/storage-list.css' %}" rel="stylesheet" />

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="css/storage-style.css">
<title>청중을 구해조</title>
<!-- 파비콘 -->

<link rel="icon" href="../img/favicon.ico" />
<!-- Font Awesome 아이콘 (무료 버전) -->
<script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
<!-- 구글 폰트 -->
<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
<link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
<!-- 핵심 테마 CSS (부트스트랩 포함) -->
    <style>
        @media (min-width: 768px) {
            /* md 사이즈 이상일 때 */
            .custom-border {
                border-right: dotted;
                border-bottom: none;
            }
        }

        @media (max-width: 767.98px) {
            /* md 사이즈 미만일 때 */
            .custom-border {
                border-right: none;
                border-bottom: dotted;
            }
        }
    </style>


</head>
<body>

    <header class="mb-auto p-5">
        <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav" style="background-color:#5a9e93 !important;">
            <div class="container" style="position: fixed; top: 0; right: 0; left: 0;">
                <a class="navbar-brand" href="introduction-page.html"><img src="../img/introduction-page-img/m_logo.png"></a>
                <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="introduction-page.html">소개</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="lecture-preset.html">청중 분석</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="storage-list.html">분석 저장소</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="login-page.html">LOGOUT</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

<section class="notice" style="padding-top: 2rem;">
    <div class="page-title">
        <div class="container">
            <h3 style="font-weight:700;">강의 기록</h3>
        </div>
    </div>

    <!-- board seach area -->
    <div id="board-search">
        <div class="container">
            <div class="search-window">
                <form method="get">
                    <div class="search-wrap">
                        <label for="search" class="blind">강의 내용 검색</label>
                        <input id="search" type="text" name="search" placeholder="검색어를 입력해주세요." value="{{ request.GET.search }}">
                        <button type="submit" class="btn btn-dark"
                                style="--bs-btn-border-color: #5a9e93; --bs-btn-bg: #5a9e93">검색
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- board list area -->
    <div id="board-list">
        <div class="container">
            <table class="board-table">
                <thead>
                <tr>
                    <th scope="col" class="th-num">번호</th>
                    <th scope="col" class="th-title">제목</th>
                    <th scope="col" class="th-date">등록일</th>
                </tr>
                </thead>
                <tbody>
                {% for lecture in lectures %}
                    <tr>
                        <td>{{ forloop.counter0|add:lectures.start_index }}</td>
                        <th>
                            <a href="{% url 'report:detail' lecture.id %}">{{ lecture.topic }}</a>
                            <p>테스트</p>
                        </th>
                        <td>{{ lecture.datetime|date:"Y.m.d" }}</td>
                        <td>
                            <button class='delete btn btn-dark' style="border-radius: 0.4rem" lecture_id={{ lecture.id }}>삭제</button>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="3" style="text-align: center;">분석 결과가 없습니다</td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <div class="pagination prev-next-area">
    <span class="step-links prev-next">
    <a href="?page=1">처음</a>
        {% if lectures.has_previous %}
            <a href="?page={{ lectures.previous_page_number }}">이전</a>
        {% else %}
            <span class="disabled">이전</span>
        {% endif %}

        {% for i in lectures.paginator.page_range %}
            {% if lectures.number == i %}
                <span class="current"> {{ i }} </span>
            {% else %}
                <a href="?page={{ i }}"> {{ i }} </a>
            {% endif %}
        {% endfor %}

        {% if lectures.has_next %}
            <a href="?page={{ lectures.next_page_number }}">다음</a>
        {% else %}
            <span class="disabled">다음</span>
        {% endif %}
        <a href="?page={{ lectures.paginator.num_pages }}">마지막</a>
    </span>
    </div>
</section>
<!-- Footer Section -->
<footer class="mb-auto" style="position: fixed!important; right: 0; left: 0; bottom: 0;">
    <div class="copyright py-1 text-center text-white footer-bot">
        <div class="container"><small>Copyright &copy; 청중을 구해조</small></div>
    </div>
</footer>

<!-- Bootstrap core JS-->
<script>
    window.onload = function () {
        var orderSelect = document.getElementById('orderSelect');
        orderSelect.onchange = function () {
            this.form.submit();
        };
    };

    $('.delete').click(function (e) {
        var ans = confirm('정말로 삭제하시겠습니까?');
        let lecture_id = e.target.attributes.getNamedItem('lecture_id').value;
        if (ans) {
            $.ajax({
                url: '/report/list/delete/',
                data: {
                    lecture_id: lecture_id
                },
                method: 'POST',
                success: function (result) {
                    console.log('성공')
                    location.replace('/report/list');
                },
                error: function (result, status, error) {
                    console.log('에러')
                    console.log(result);
                    console.log(status);
                    console.log(error);
                }

            });
        }


    })
</script>
{% endblock %}

</body>
</html>
