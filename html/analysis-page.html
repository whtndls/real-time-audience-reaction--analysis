<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>청중의 소리를 부탁해</title>
    <!-- 파비콘 -->
    <link rel="icon" href="../img/favicon.ico" />
    <!-- Font Awesome 아이콘 (무료 버전) -->
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <!-- 구글 폰트 -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
    <!-- 핵심 테마 CSS (부트스트랩 포함) -->
    <link href="../css/analysis-page.css" rel="stylesheet">
    <style>
        @media (min-width: 768px) {
          /* md 사이즈 이상일 때 */
          .custom-border {
            border: solid;
          }
          .col-md-8 {
            flex: 0 0 auto;
            width: 66%;
          }
          .col-md-4 {
            flex: 0 0 auto;
            width: 32.8%;
          }
          .row-md-column {
            display: flex; 
            padding-right: 0; 
            padding-left: 0; 
            padding-top: 0.7rem; 
            justify-content: space-between;
          }
        }
    
        @media (max-width: 767.98px) {
          /* md 사이즈 미만일 때 */
          .custom-border {
            border: solid;
          }
          .row-md-column {
            display: flex; 
            padding-right: 0; 
            padding-left: 0; 
            padding-top: 0.7rem; 
            justify-content: space-between;
            flex-direction: column;
          }
        }
      </style>

</head>
<body>
    <header class="mb-auto p-5">
        <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav" style="background-color: #5a9e93 !important;">
            <div class="container" style="position: fixed; top: 0; right: 0; left: 0;">
                <a class="navbar-brand" href="introduction-page.html"><img src="../img/introduction-page-img/m_logo.png"></a>
                <button class="navbar-toggler text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto" style="text-align: center;">
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="introduction-page.html">소개</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="lecture-preset.html">청중 분석</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="storage-list.html">분석 저장소</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded" href="login-page.html">LOGOUT</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main class="mb-auto p-5" style="padding-top: 0px!important">
        <section style="color: #73C5B7">
            <main class="p-3 contents-center container row grid-sorting" style="height: 100%; margin-right: auto; margin-left: auto;">
                <div class="page-section-heading text-left text-uppercase mb-0 border-wrapping">
                  <h3 style="display: inline-block; margin-right: 10px; margin-bottom: 0">강의 주제</h3>
                  <h5 style="display: inline-block; margin-bottom: 0; color: black">강의 주제 나오는 곳</h5>
                </div>
                
                  <div class="row-md-column">
                      <div class="col-12 col-md-8 p-3 analysis-card border-md-end custom-border border-wrapping" style="border-radius: 0.6rem; margin-bottom: 0.7rem">
            </head>
                <div>
                <video id="video" width="100%" height="50%" autoplay style="border-radius: 0.6rem;"></video>
                <br>
                <div id="timer-container">
                    <div id="timer">00:00:00</div>
                </div>
                    <div class="button-center">
                        <div>
                            <button id="LectureStart" class="record-button btn btn-primary btn-lg">강의시작</button>
                        </div>
                        <div>
                            <button id="LectureStop" class="stop-button btn btn-primary btn-lg pause-button">강의종료</button>
                        </div>
                    </div>
                </div>
              
              <script>
                const video = document.getElementById('video');
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                navigator.mediaDevices.getUserMedia({ video: true })
                  .then(stream => {
                    video.srcObject = stream;
                  });
                
                function captureImage() {
                  canvas.width = video.videoWidth;
                  canvas.height = video.videoHeight;
                  context.drawImage(video, 0, 0);
                  canvas.toBlob(blob => {
                    const formData = new FormData();
                    formData.append('camera-image', blob);
                    fetch('/test/', {
                      method: 'POST',
                      body: formData
                    });
                  });
                }
              </script>
                      </div>
                      <div class="col-12 col-md-4 p-3 analysis-card border-wrapping" style="margin-bottom: 0.7rem;">
                        <img id="emotionImage" src="" alt="Emotion Image" style="width: 100%">
                        <div id="concentrationTextElement" style="width: 100%; text-align: center; font-weight: 800;">현재 청중들의 상태는</div>
                        <div id="concentrationTextElement" style="width: 100%; text-align: center; font-weight: 800;
                        font-size: large;"></div>
                      </div>
                  </div>
              </main>
        </section>
    </main>
    <!-- Footer Section -->
<footer class="mb-auto footer-bot">
    <div class="copyright py-1 text-center text-white">
        <div class="container"><small>Copyright &copy; 청중을 구해조</small></div>
    </div>
</footer>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script src="../js/navbar_current_page_underline_effect.js"></script>
<script src="../js/analysis-page-lecture-timer.js"></script>
<!--집중도에 따라 이모티콘이 바뀌어 나오게 만드는 js-->
<script>
  var emotionImage = document.getElementById('emotionImage');
  emotionImage.src = '../img/emotion/neutral.png';
  concentrationTextElement = '무표정: 청중들의 집중도가 중간입니다.'
  function updateEmotionImage() {
    $.ajax({
        url: 'get_concentration_data.php',
        type: 'GET',
        dataType: 'json',
        success: function(data) {
          var concentrationText = '';  // 초기값 설정

          if (data.concentration >= 66) {
              emotionImage.src = 'smile.png';
              concentrationText = '집중력이 높습니다.';
          } else if (data.concentration >= 33 && data.concentration < 66) {
              emotionImage.src = 'neutral.png';
              concentrationText = '집중도가 중간입니다.';
          } else if (data.concentration < 33) {
              emotionImage.src = 'sad.png';
              concentrationText = '집중도가 낮습니다.';
          }

          // 여기서 concentrationText를 사용하여 원하는 곳에 출력하도록 설정
          // 예를 들어, 어떤 HTML 요소에 출력한다면:
          // document.getElementById('concentrationTextElement').innerText = concentrationText;
        },
        error: function() {
            console.error('Failed to fetch concentration data.');
        }
    });
}

    /* function updateEmotionImage() {
        $.ajax({
            url: 'get_concentration_data.php',
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                // 집중도에 따라 이미지 업데이트
                var emotionImage = document.getElementById('emotionImage');
                emotionImage.src = (data.concentration >= 50) ? 'smile.jpg' : 'sad.jpg';
            },
            error: function() {
                console.error('Failed to fetch concentration data.');
            }
        });
    }
    */
    // 일정 간격으로 업데이트
    setInterval(updateEmotionImage, 5000);  // 5초마다 업데이트
    updateEmotionImage();  // 초기 로딩 시에도 업데이트
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      var lectureTitle = localStorage.getItem('lectureTitle');
      if (lectureTitle) {
          var titleElement = document.querySelector('.page-section-heading h5');
          titleElement.textContent = lectureTitle;
      }
  });
  </script>
  
</body>
</html>